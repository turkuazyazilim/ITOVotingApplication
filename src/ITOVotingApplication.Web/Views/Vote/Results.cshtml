@* VotingApplication.Web/Views/Vote/Results.cshtml *@
@model ITOVotingApplication.Web.Models.VoteResultsViewModel
@{
    ViewData["Title"] = "Seçim Sonuçları";
}

<div class="container-fluid">
    <h1 class="mt-4">Seçim Sonuçları</h1>
    <ol class="breadcrumb mb-4">
        <li class="breadcrumb-item"><a asp-action="Index">Oy Kullandırma</a></li>
        <li class="breadcrumb-item active">Sonuçlar</li>
    </ol>

    @if (Model.Results?.Any() == true)
    {
        @foreach (var result in Model.Results)
        {
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5><i class="fas fa-box"></i> @result.BallotBoxDescription</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="text-center">
                                <h3>@result.TotalVotes</h3>
                                <p class="text-muted">Kullanılan Oy</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h3>@result.EligibleVoters</h3>
                                <p class="text-muted">Toplam Seçmen</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h3>%@result.TurnoutPercentage.ToString("F2")</h3>
                                <p class="text-muted">Katılım Oranı</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h3>@(result.EligibleVoters - result.TotalVotes)</h3>
                                <p class="text-muted">Oy Kullanmayan</p>
                            </div>
                        </div>
                    </div>

                    <div class="progress mt-3" style="height: 30px;">
                        <div class="progress-bar bg-success" role="progressbar"
                             style="width: @result.TurnoutPercentage%"
                             aria-valuenow="@result.TurnoutPercentage"
                             aria-valuemin="0" aria-valuemax="100">
                            %@result.TurnoutPercentage.ToString("F2")
                        </div>
                    </div>

                    @if (result.LastVoteDate != DateTime.MinValue)
                    {
                        <p class="text-muted mt-2">
                            <small>Son oy: @result.LastVoteDate.ToString("dd.MM.yyyy HH:mm")</small>
                        </p>
                    }
                </div>
            </div>
        }

        <!-- Genel Toplam -->
        <div class="card">
            <div class="card-header bg-dark text-white">
                <h5><i class="fas fa-chart-pie"></i> Genel Toplam</h5>
            </div>
            <div class="card-body">
                @{
                    var totalVotes = Model.Results.Sum(r => r.TotalVotes);
                    var totalEligible = Model.Results.Sum(r => r.EligibleVoters);
                    var overallTurnout = totalEligible > 0 ? (decimal)totalVotes / totalEligible * 100 : 0;
                }
                <div class="row">
                    <div class="col-md-4">
                        <div class="text-center">
                            <h2 class="text-primary">@totalVotes</h2>
                            <p>Toplam Kullanılan Oy</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-center">
                            <h2 class="text-info">@totalEligible</h2>
                            <p>Toplam Seçmen Sayısı</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-center">
                            <h2 class="text-success">%@overallTurnout.ToString("F2")</h2>
                            <p>Genel Katılım Oranı</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i> Henüz oy kullanılmamış.
        </div>
    }

    <div class="mt-3">
        <a asp-action="Index" class="btn btn-primary">
            <i class="fas fa-arrow-left"></i> Geri Dön
        </a>
        <button onclick="window.print()" class="btn btn-secondary">
            <i class="fas fa-print"></i> Yazdır
        </button>
    </div>
</div>